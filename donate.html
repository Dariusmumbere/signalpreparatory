<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading... - SIGNAL PREPARATORY SCHOOL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <link rel="stylesheet" href="donate.css">  
    <style>
        .loading-content {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            font-size: 1.2rem;
            color: #666;
        }
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- CMS Admin Button (visible when logged in) -->
    <a href="/admin/" class="cms-admin-btn" id="cmsAdminBtn" style="display: none;">
        <i class="fas fa-cog"></i> <span id="admin-btn-text">CMS Admin</span>
    </a>
    
    <!-- CMS Login Modal -->
    <div class="cms-modal" id="cmsModal">
        <div class="cms-modal-content">
            <h2>Website Administration</h2>
            <p>To access the content management system, please log in with your administrator credentials.</p>
            <button class="cms-modal-btn" onclick="window.location.href='/admin/'">Go to Admin</button>
            <button class="cms-modal-btn cms-modal-close" onclick="closeModal()">Close</button>
        </div>
    </div>

    <nav class="navbar" id="navbar">
        <div class="logo-container">
            <img src="logo.png" alt="Logo" class="logo" id="main-logo">
            <div class="logo-text" id="school-name">Loading...</div>
        </div>
        
        <!-- Modern Hamburger Menu -->
        <div class="hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>

        <!-- Navbar Links -->
        <ul class="nav-links" id="navLinks">
            <li><a href="index.html" class="nav-item">Home</a></li>
            <li><a href="about.html" class="nav-item">About</a></li>
            <li><a href="projects.html" class="nav-item">Projects</a></li>
            <li><a href="address.html" class="nav-item">Contacts</a></li>
            <li><a href="donate.html" class="nav-item"><button class="donate-btn">Donate</button></a></li>
        </ul>
    </nav>
    
    <main class="donate-container">
        <div class="donate-header">
            <h1 id="donate-main-heading" class="loading-content"><div class="loading-spinner"></div>Loading content...</h1>
            <p id="donate-subheading"></p>
        </div>

        <div class="donate-content">
            <div class="why-donate">
                <h2 id="why-donate-heading"></h2>
                <div id="why-donate-content" class="loading-content"><div class="loading-spinner"></div>Loading content...</div>
            </div>
            
            <div class="donate-via">
                <h2 id="donation-methods-heading"></h2>
                <div class="payment-methods" id="payment-methods-container" class="loading-content"><div class="loading-spinner"></div>Loading payment methods...</div>
            </div>
        </div>

        <div class="parallax-section">
            <div class="parallax-image" id="donate-parallax-image"></div>
            <div class="parallax-content">
                <h2 id="parallax-heading"></h2>
                <p id="parallax-text"></p>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-container">
            <!-- Logo and School Name -->
            <div class="footer-column logo-column">
                <div class="logo-container">
                    <img src="logo.png" alt="Signal Preparatory School Logo" class="footer-logo" id="footer-logo">
                    <div class="footer-logo-text" id="footer-school-name">Loading...</div>
                </div>
                <p class="footer-text" id="footer-tagline"></p>
                <div class="social-icons" id="social-icons-container"></div>
            </div>
    
            <!-- Quick Links -->
            <div class="footer-column">
                <h3 class="footer-heading" id="footer-links-heading">Quick Links</h3>
                <ul class="footer-links" id="footer-links-container"></ul>
            </div>
    
            <!-- Contact Information -->
            <div class="footer-column">
                <h3 class="footer-heading" id="contact-heading">Contact Us</h3>
                <p class="footer-text" id="footer-email"></p>
                <p class="footer-text" id="footer-phone1"></p>
                <p class="footer-text" id="footer-phone2"></p>
                <p class="footer-text" id="footer-address"></p>
            </div>
        </div>
    
        <!-- Footer Bottom Section -->
        <div class="footer-bottom">
            <p class="footer-copyright" id="copyright-text"></p>
            <p class="designer-credit" id="designer-credit"></p>
            <a href="/admin/" class="admin-link" id="admin-link-text"></a>
        </div>
    </footer>

    <!-- Marked.js for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Content Loading Script -->
    <script>
        // First, clear all content areas that will be populated from JSON
        function clearContentAreas() {
            // Main content
            document.getElementById('donate-main-heading').innerHTML = '<div class="loading-spinner"></div>Loading content...';
            document.getElementById('donate-subheading').textContent = '';
            document.getElementById('why-donate-heading').textContent = '';
            document.getElementById('why-donate-content').innerHTML = '<div class="loading-spinner"></div>Loading content...';
            document.getElementById('donation-methods-heading').textContent = '';
            document.getElementById('payment-methods-container').innerHTML = '<div class="loading-spinner"></div>Loading payment methods...';
            document.getElementById('parallax-heading').textContent = '';
            document.getElementById('parallax-text').textContent = '';
            
            // Footer
            document.getElementById('footer-school-name').textContent = 'Loading...';
            document.getElementById('footer-tagline').textContent = '';
            document.getElementById('social-icons-container').innerHTML = '';
            document.getElementById('footer-links-container').innerHTML = '';
            document.getElementById('footer-email').textContent = '';
            document.getElementById('footer-phone1').textContent = '';
            document.getElementById('footer-phone2').textContent = '';
            document.getElementById('footer-address').textContent = '';
            document.getElementById('copyright-text').textContent = '';
            document.getElementById('designer-credit').textContent = '';
            document.getElementById('admin-link-text').textContent = '';
        }

        // Load content from JSON
        function loadContent() {
            clearContentAreas();
            
            fetch('/src/data/donate.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Successfully loaded JSON data:', data);
                    updateContent(data);
                })
                .catch(error => {
                    console.error('Error loading donate content:', error);
                    loadFallbackContent();
                });
        }

        // Update content with JSON data
        function updateContent(data) {
            try {
                // Site-wide content
                if (data.title) {
                    document.getElementById('site-title').textContent = data.title;
                    document.title = data.title;
                }
                if (data.school_name) {
                    document.getElementById('school-name').textContent = data.school_name;
                    document.getElementById('footer-school-name').textContent = data.school_name;
                }
                if (data.logo) {
                    document.getElementById('main-logo').src = data.logo;
                    document.getElementById('footer-logo').src = data.logo;
                }
                if (data.admin_text) {
                    document.getElementById('admin-btn-text').textContent = data.admin_text;
                    document.getElementById('admin-link-text').textContent = data.admin_text;
                }

                // Donate Header
                if (data.donate_main_heading) {
                    document.getElementById('donate-main-heading').textContent = data.donate_main_heading;
                }
                if (data.donate_subheading) {
                    document.getElementById('donate-subheading').textContent = data.donate_subheading;
                }

                // Why Donate Section
                if (data.why_donate_heading) {
                    document.getElementById('why-donate-heading').textContent = data.why_donate_heading;
                }
                if (data.why_donate_text) {
                    try {
                        let cleanContent = data.why_donate_text.replace(/<!--StartFragment-->|<!--EndFragment-->/g, '').trim();
                        document.getElementById('why-donate-content').innerHTML = marked.parse(cleanContent);
                    } catch (e) {
                        console.error('Error parsing markdown:', e);
                        document.getElementById('why-donate-content').innerHTML = data.why_donate_text;
                    }
                }

                // Donation Methods
                if (data.donation_methods_heading) {
                    document.getElementById('donation-methods-heading').textContent = data.donation_methods_heading;
                }
                if (data.payment_methods && Array.isArray(data.payment_methods)) {
                    const container = document.getElementById('payment-methods-container');
                    container.innerHTML = '';
                    
                    data.payment_methods.forEach(method => {
                        const methodDiv = document.createElement('div');
                        methodDiv.className = 'payment-method';
                        
                        if (method.icon_class) {
                            const icon = document.createElement('i');
                            icon.className = method.icon_class;
                            methodDiv.appendChild(icon);
                        }
                        
                        if (method.title) {
                            const title = document.createElement('h3');
                            title.textContent = method.title;
                            methodDiv.appendChild(title);
                        }
                        
                        if (method.details && Array.isArray(method.details)) {
                            method.details.forEach(detail => {
                                if (detail.detail) {
                                    const p = document.createElement('p');
                                    p.textContent = detail.detail;
                                    methodDiv.appendChild(p);
                                }
                            });
                        }
                        
                        container.appendChild(methodDiv);
                    });
                }

                // Parallax Section
                if (data.parallax_image) {
                    document.getElementById('donate-parallax-image').style.backgroundImage = `url('${data.parallax_image}')`;
                }
                if (data.parallax_heading) {
                    document.getElementById('parallax-heading').textContent = data.parallax_heading;
                }
                if (data.parallax_text) {
                    document.getElementById('parallax-text').textContent = data.parallax_text;
                }

                // Footer Section
                if (data.footer_tagline) {
                    document.getElementById('footer-tagline').textContent = data.footer_tagline;
                }

                // Social Links
                if (data.social_links && Array.isArray(data.social_links)) {
                    const container = document.getElementById('social-icons-container');
                    container.innerHTML = '';
                    
                    data.social_links.forEach(link => {
                        if (link.url) {
                            const a = document.createElement('a');
                            a.href = link.url;
                            a.target = '_blank';
                            a.className = 'social-icon';
                            
                            const icon = document.createElement('i');
                            icon.className = getSocialIconClass(link.platform);
                            a.appendChild(icon);
                            
                            container.appendChild(a);
                        }
                    });
                }

                // Footer Links
                if (data.footer_links && Array.isArray(data.footer_links)) {
                    const container = document.getElementById('footer-links-container');
                    container.innerHTML = '';
                    
                    data.footer_links.forEach(link => {
                        if (link.url && link.text) {
                            const li = document.createElement('li');
                            const a = document.createElement('a');
                            a.href = link.url;
                            a.className = 'footer-link';
                            a.textContent = link.text;
                            li.appendChild(a);
                            container.appendChild(li);
                        }
                    });
                }

                // Contact Info
                if (data.contact_heading) {
                    document.getElementById('contact-heading').textContent = data.contact_heading;
                }
                if (data.email) {
                    document.getElementById('footer-email').textContent = `Email: ${data.email}`;
                }
                if (data.phone1) {
                    document.getElementById('footer-phone1').textContent = `Phone: ${data.phone1}`;
                }
                if (data.phone2) {
                    document.getElementById('footer-phone2').textContent = `Phone: ${data.phone2}`;
                }
                if (data.address) {
                    document.getElementById('footer-address').textContent = `Address: ${data.address}`;
                }

                // Footer Bottom
                if (data.copyright_text) {
                    document.getElementById('copyright-text').innerHTML = data.copyright_text;
                }
                if (data.designer_text) {
                    document.getElementById('designer-credit').textContent = data.designer_text;
                }
                if (data.designer_link) {
                    document.getElementById('designer-link').href = data.designer_link;
                }
                if (data.designer_name) {
                    document.getElementById('designer-link').textContent = data.designer_name;
                }

            } catch (error) {
                console.error('Error updating content:', error);
                loadFallbackContent();
            }
        }

        function getSocialIconClass(platform) {
            if (!platform) return 'fas fa-share-alt';
            const platformLower = platform.toLowerCase();
            if (platformLower.includes('facebook')) return 'fab fa-facebook-f';
            if (platformLower.includes('twitter')) return 'fab fa-twitter';
            if (platformLower.includes('instagram')) return 'fab fa-instagram';
            if (platformLower.includes('youtube')) return 'fab fa-youtube';
            if (platformLower.includes('linkedin')) return 'fab fa-linkedin';
            if (platformLower.includes('tiktok')) return 'fab fa-tiktok';
            return 'fas fa-share-alt';
        }

        function loadFallbackContent() {
            console.log('Loading fallback content');
            
            // Main content
            document.getElementById('donate-main-heading').textContent = 'Support Our Cause';
            document.getElementById('donate-subheading').textContent = 'Your contribution helps us make a difference. Every donation counts!';
            document.getElementById('why-donate-heading').textContent = 'Why Donate?';
            document.getElementById('why-donate-content').innerHTML = `
                <p>Your donations help us continue our mission to provide quality education and support to underprivileged children. With your support, we can build a brighter future for the next generation by funding educational programs, school supplies, and infrastructure improvements that directly benefit our students.</p>
                <p>At Signal Preparatory School, we believe every child deserves access to quality education regardless of their background. Your generous contributions help us maintain this vision and expand our impact in the community.</p>
            `;
            document.getElementById('donation-methods-heading').textContent = 'Donation Methods';
            
            // Fallback payment methods
            const paymentMethodsContainer = document.getElementById('payment-methods-container');
            paymentMethodsContainer.innerHTML = `
                <div class="payment-method">
                    <i class="fas fa-mobile-alt"></i>
                    <h3>MTN Mobile Money</h3>
                    <p>+256 775413318</p>
                    <p>Name: Signal Arts</p>
                </div>
                <div class="payment-method">
                    <i class="fas fa-mobile-alt"></i>
                    <h3>Airtel Money</h3>
                    <p>+256754406992</p>
                    <p>Name: Signal Arts</p>
                </div>
                <div class="payment-method">
                    <i class="fas fa-university"></i>
                    <h3>Bank Transfer</h3>
                    <p>Centenary Bank</p>
                    <p>Account: 3200054198</p>
                    <p>Name: Signal Arts</p>
                </div>
            `;
            
            document.getElementById('parallax-heading').textContent = 'Together We Can Make a Difference';
            document.getElementById('parallax-text').textContent = 'Your support helps us create a better future for everyone. Join us in our mission to bring positive change through education. Every donation, no matter the size, contributes to transforming lives and building a brighter tomorrow for our students and community.';
            
            // Footer fallback
            document.getElementById('footer-school-name').textContent = 'SIGNAL PREPARATORY SCHOOL';
            document.getElementById('footer-tagline').textContent = 'Mentoring a coexisting generation with creativity, innovation, and environmental respect.';
            document.getElementById('footer-email').textContent = 'Email: signalarts1@gmail.com';
            document.getElementById('footer-phone1').textContent = 'Phone: +256 775413318';
            document.getElementById('footer-phone2').textContent = 'Phone: +256754406992';
            document.getElementById('footer-address').textContent = 'Address: Bwera, Kasese, Uganda';
            document.getElementById('copyright-text').innerHTML = '&copy; 2025 Signal Preparatory School. All Rights Reserved.';
            document.getElementById('designer-credit').textContent = 'Designed by Mumbere Darius';
            document.getElementById('designer-link').href = 'https://dariusmumbere.github.io/personal';
            document.getElementById('designer-link').textContent = 'Mumbere Darius';
            document.getElementById('admin-link-text').textContent = 'Admin Login';
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Skip if in admin interface
            if (window.location.pathname.includes('/admin/')) return;

            // Modern toggle menu with animation
            const hamburger = document.getElementById('hamburger');
            const navLinks = document.getElementById('navLinks');
            
            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                navLinks.classList.toggle('active');
                document.body.style.overflow = navLinks.classList.contains('active') ? 'hidden' : '';
            });
            
            // Close menu when clicking on a link
            document.querySelectorAll('.nav-item').forEach(link => {
                link.addEventListener('click', () => {
                    hamburger.classList.remove('active');
                    navLinks.classList.remove('active');
                    document.body.style.overflow = '';
                });
            });
            
            // Navbar scroll effect
            const navbar = document.getElementById('navbar');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    navbar.classList.add('scrolled');
                } else {
                    navbar.classList.remove('scrolled');
                }
            });
            
            // Netlify Identity and CMS Integration
            if (window.netlifyIdentity) {
                window.netlifyIdentity.on("init", user => {
                    if (!user) {
                        window.netlifyIdentity.on("login", () => {
                            document.location.href = "/admin/";
                        });
                    }
                });
                
                // Check if user is logged in
                const currentUser = netlifyIdentity.currentUser();
                if (currentUser) {
                    document.getElementById('cmsAdminBtn').style.display = 'flex';
                }
                
                // Listen for login events
                netlifyIdentity.on('login', user => {
                    document.getElementById('cmsAdminBtn').style.display = 'flex';
                    closeModal();
                });
                
                // Listen for logout events
                netlifyIdentity.on('logout', () => {
                    document.getElementById('cmsAdminBtn').style.display = 'none';
                });
            }
            
            // Modal functions
            function openModal() {
                document.getElementById('cmsModal').style.display = 'flex';
            }
            
            function closeModal() {
                document.getElementById('cmsModal').style.display = 'none';
            }
            
            // Admin link click handler
            document.querySelector('.admin-link').addEventListener('click', function(e) {
                e.preventDefault();
                openModal();
            });
            
            // Close modal when clicking outside
            document.getElementById('cmsModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            // Load the content
            loadContent();
        });
    </script>
</body>
</html>
