<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ site_content.title || 'SIGNAL PREPARATORY SCHOOL' }}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <link rel="stylesheet" href="home.css">
</head>
<body>
    <!-- CMS Admin Button (visible when logged in) -->
    <a href="/admin/" class="cms-admin-btn" id="cmsAdminBtn" style="display: none;">
        <i class="fas fa-cog"></i> CMS Admin
    </a>
    
    <!-- CMS Login Modal -->
    <div class="cms-modal" id="cmsModal">
        <div class="cms-modal-content">
            <h2>Website Administration</h2>
            <p>To access the content management system, please log in with your administrator credentials.</p>
            <button class="cms-modal-btn" onclick="window.location.href='/admin/'">Go to Admin</button>
            <button class="cms-modal-btn cms-modal-close" onclick="closeModal()">Close</button>
        </div>
    </div>

    <nav class="navbar" id="navbar">
        <div class="logo-container">
            <img src="{{ site_content.logo || 'logo.png' }}" alt="Logo" class="logo">
            <div class="logo-text">{{ site_content.school_name || 'SIGNAL PREPARATORY<br>SCHOOL' }}</div>
        </div>
        
        <!-- Modern Hamburger Menu -->
        <div class="hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>

        <!-- Navbar Links -->
        <ul class="nav-links" id="navLinks">
            <li><a href="index.html" class="nav-item">Home</a></li>
            <li><a href="about.html" class="nav-item">About</a></li>
            <li><a href="projects.html" class="nav-item">Projects</a></li>
            <li><a href="address.html" class="nav-item">Contacts</a></li>
            <li><a href="donate.html" class="nav-item"><button class="donate-btn">Donate</button></a></li>
        </ul>
    </nav>
    
    <section class="hero">
        <div class="hero-overlay"></div>
        <div class="slideshow">
            {% for image in site_content.slideshow_images %}
            <img src="{{ image.image }}" class="slide {% if forloop.first %}active{% endif %}" alt="{{ image.alt }}">
            {% endfor %}
        </div>
        <div class="hero-content">
            <h2>{{ site_content.hero_heading }}</h2>
            <p>{{ site_content.hero_text }}</p>
            <button class="hero-button">{{ site_content.hero_button_text }}</button>
        </div>
    </section>

    <section class="about-section">
        <div class="about-container">
            <div class="about-image">
                <img src="{{ site_content.about_image || 'about-image.jpg' }}" alt="About Signal Preparatory">
            </div>
            <div class="about-content">
                <h2>{{ site_content.about_heading }}</h2>
                <div>
                    {{ site_content.about_text | markdownify }}
                </div>
                <a href="#" class="learn-more-btn">{{ site_content.learn_more_text || 'Learn More' }}</a>
            </div>
        </div>
    </section>

    <section class="vision-section">
        <div class="vision-image">
            <img src="{{ site_content.vision_image || 'your-image.jpg' }}" alt="Signal Preparatory school">
        </div>
        <div class="vision-content">
            <h2>{{ site_content.vision_heading || 'Our Vision' }}</h2>
            <div>
                {{ site_content.vision_text | markdownify }}
            </div>
            <a href="#" class="btn">{{ site_content.donate_button_text || 'Donate Now' }}</a>
        </div>
    </section>

    <div class="container">
        <div class="card">
            <h2>{{ site_content.headteacher_heading || 'Welcome from the Headteacher' }}</h2>
            <p>{{ site_content.headteacher_message || 'At Signal School, our guiding principle is "Aim High, Be Kind, and Dare to save mother earth". This is deeply rooted at our core and combined with exceptional teaching.' }}</p>
        </div>
        <div class="card">
            <h2>{{ site_content.visit_heading || 'Visit Signal School' }}</h2>
            <p>{{ site_content.visit_text || 'Experience firsthand hospitality, creativity, and a child-based culture in the teaching/learning process.' }}</p>
            <p>{{ site_content.visit_text_continued || 'Be part of our movement. Visit and leave a mark of Peace, Love, and Kindness that our generation in the making shall celebrate your visit for life.' }}</p>
            <a href="#" class="btn">{{ site_content.visit_button_text || 'Arrange a Visit' }}</a>
        </div>
        <div class="card logo-card">
            <img src="{{ site_content.secondary_logo || 'logo.png' }}" alt="School Logo">
        </div>
    </div>

    <section class="section">
        <div class="content">
            <h2>{{ site_content.ethos_heading || 'The Ethos and the Environment' }}</h2>
            <p>{{ site_content.ethos_text || 'At Signal Preparatory School, our ethos goes beyond academia. We believe in nurturing the whole child, promoting coexistence, creativity, and global awareness.' }}</p>
            <p>{{ site_content.ethos_text_continued || 'Child Art, Child Waste Management, Child Kitchen Gardening, and Child Sports are key in our teaching-learning process.' }}</p>
            <p>{{ site_content.ethos_text_conclusion || 'Signal Preparatory School offers an environment where pupils are daily inspired both by the lessons in the classroom and the serenity outside.' }}</p>
            <a href="#" class="read-more">{{ site_content.read_more_text || 'Read More' }}</a>
        </div>
        <div class="image-container">
            <img src="{{ site_content.ethos_image || 'secc.jpg' }}" alt="Children with an art project">
        </div>
    </section>

    <h1 class="section-title">{{ site_content.join_heading || 'Join us and play your part' }}</h1>
    <h2 class="sub-title">{{ site_content.thematic_heading || 'Our thematic areas' }}</h2>
    
    <div class="programs-container">
        {% for program in site_content.programs %}
        <div class="program">
            <img src="{{ program.image }}" alt="{{ program.title }}">
            <h3 class="program-title">{{ program.title }}</h3>
            <p class="program-description">{{ program.description }}</p>
        </div>
        {% endfor %}
    </div>

    <div class="alternate-container">
        <!-- First Row -->
        <div class="alternate-row">
            <div class="alternate-image-container">
                <img src="{{ site_content.academic_image || 'academic.jpg' }}" alt="Children Learning">
            </div>
            <div class="alternate-text-container">
                <h2>{{ site_content.academic_heading || 'Academic Excellence' }}</h2>
                <p>
                    {{ site_content.academic_text || 'Dynamic instruction at Signal School fosters intellectual curiosity, autonomy, and self-assurance. We inspire girls and boys to cultivate distinctiveness in character and innovative thought. This has made our Pupils icons of community transformation.' }}
                </p>
                <button class="alternate-read-more">{{ site_content.read_more_button || 'Read More' }}</button>
            </div>
        </div>

        <!-- Second Row (Alternated) -->
        <div class="alternate-row">
            <div class="alternate-image-container">
                <img src="{{ site_content.happy_image || 'happy.jpg' }}" alt="Children Engaging in Activities">
            </div>
            <div class="alternate-text-container">
                <h2>{{ site_content.happy_heading || 'A happy Learning Environment' }}</h2>
                <p>
                    {{ site_content.happy_text || 'Our objective is to ignite a lifelong passion for learning. By challenging the advanced and uplifting the less assured, we ensure each pupil realizes their unique academic potential that can help him be an inspiration the world needs.' }}
                </p>
                <button class="alternate-read-more">{{ site_content.read_more_button || 'Read More' }}</button>
            </div>
        </div>
    </div>

    <div class="kindergarten-counter-section">
        <div class="counter-box students">
            <h2 class="count" data-target="{{ site_content.student_count || 150 }}">0</h2>
            <p>{{ site_content.student_label || 'Total pupils at Signal preparatory' }}</p>
        </div>
        <div class="counter-box teachers">
            <h2 class="count" data-target="{{ site_content.alumni_count || 600 }}">0</h2>
            <p>{{ site_content.alumni_label || 'School alumni' }}</p>
        </div>
        <div class="counter-box activities">
            <h2 class="count" data-target="{{ site_content.activities_count || 300 }}">0</h2>
            <p>{{ site_content.activities_label || 'Fun Activities Completed' }}</p>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-container">
            <!-- Logo and School Name -->
            <div class="footer-column logo-column">
                <div class="logo-container">
                    <img src="{{ site_content.footer_logo || 'logo.png' }}" alt="Signal Preparatory School Logo" class="footer-logo">
                    <div class="footer-logo-text">{{ site_content.footer_school_name || 'SIGNAL PREPARATORY<br>SCHOOL' }}</div>
                </div>
                <p class="footer-text">{{ site_content.footer_tagline || 'Mentoring a coexisting generation with creativity, innovation, and environmental respect.' }}</p>
                <div class="social-icons">
                    {% for social in site_content.social_links %}
                    <a href="{{ social.url }}" target="_blank" class="social-icon"><i class="fab fa-{{ social.platform }}"></i></a>
                    {% endfor %}
                </div>
            </div>
    
            <!-- Quick Links -->
            <div class="footer-column">
                <h3 class="footer-heading">{{ site_content.quick_links_heading || 'Quick Links' }}</h3>
                <ul class="footer-links">
                    {% for link in site_content.footer_links %}
                    <li><a href="{{ link.url }}" class="footer-link">{{ link.text }}</a></li>
                    {% endfor %}
                </ul>
            </div>
    
            <!-- Contact Information -->
            <div class="footer-column">
                <h3 class="footer-heading">{{ site_content.contact_heading || 'Contact Us' }}</h3>
                <p class="footer-text">{{ site_content.email || 'Email: signalarts1@gmail.com' }}</p>
                <p class="footer-text">{{ site_content.phone1 || 'Phone: +256 775413318' }}</p>
                <p class="footer-text">{{ site_content.phone2 || 'Phone: +256754406992' }}</p>
                <p class="footer-text">{{ site_content.address || 'Address: Bwera, Kasese, Uganda' }}</p>
            </div>
        </div>
    
        <!-- Footer Bottom Section -->
        <div class="footer-bottom">
            <p class="footer-copyright">&copy; {{ 'now' | date: "%Y" }} {{ site_content.copyright_text || 'Signal Preparatory School. All Rights Reserved.' }}</p>
            <p class="designer-credit">{{ site_content.designer_text || 'Designed by' }} <a href="{{ site_content.designer_link || '#' }}" class="designer-link">{{ site_content.designer_name || 'Mumbere Darius' }}</a></p>
            <a href="/admin/" class="admin-link">{{ site_content.admin_text || 'Admin Login' }}</a>
        </div>
    </footer>

    <!-- Marked.js for markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Content Loading Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Skip if in admin interface
            if (window.location.pathname.includes('/admin/')) return;

            // Modern toggle menu with animation
            const hamburger = document.getElementById('hamburger');
            const navLinks = document.getElementById('navLinks');
            
            hamburger.addEventListener('click', () => {
                hamburger.classList.toggle('active');
                navLinks.classList.toggle('active');
                document.body.style.overflow = navLinks.classList.contains('active') ? 'hidden' : '';
            });
            
            // Close menu when clicking on a link
            document.querySelectorAll('.nav-item').forEach(link => {
                link.addEventListener('click', () => {
                    hamburger.classList.remove('active');
                    navLinks.classList.remove('active');
                    document.body.style.overflow = '';
                });
            });
            
            // Navbar scroll effect
            const navbar = document.getElementById('navbar');
            window.addEventListener('scroll', () => {
                if (window.scrollY > 50) {
                    navbar.classList.add('scrolled');
                } else {
                    navbar.classList.remove('scrolled');
                }
            });
            
            // Slideshow functionality
            let currentSlide = 0;
            const slides = document.querySelectorAll('.slide');
            
            function showSlide(n) {
                slides.forEach(slide => {
                    slide.classList.remove('active');
                    slide.classList.add('fade-out');
                });
                
                currentSlide = (n + slides.length) % slides.length;
                slides[currentSlide].classList.add('active');
                slides[currentSlide].classList.remove('fade-out');
            }
            
            function nextSlide() {
                showSlide(currentSlide + 1);
            }
            
            // Change slide every 5 seconds
            const slideInterval = setInterval(nextSlide, 5000);
            
            // Pause slideshow when user hovers over it
            const slideshow = document.querySelector('.slideshow');
            slideshow.addEventListener('mouseenter', () => {
                clearInterval(slideInterval);
            });
            
            slideshow.addEventListener('mouseleave', () => {
                setInterval(nextSlide, 5000);
            });
            
            // Counter animation with Intersection Observer
            const counterSection = document.querySelector('.kindergarten-counter-section');
            const counters = document.querySelectorAll('.count');
            let animated = false;
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !animated) {
                        animateCounters();
                        animated = true;
                    }
                });
            }, { threshold: 0.5 });
            
            observer.observe(counterSection);
            
            function animateCounters() {
                counters.forEach(counter => {
                    const target = +counter.getAttribute('data-target');
                    const duration = 2000;
                    const startTime = performance.now();
                    
                    const updateCount = (currentTime) => {
                        const elapsedTime = currentTime - startTime;
                        const progress = Math.min(elapsedTime / duration, 1);
                        const value = Math.floor(progress * target);
                        
                        counter.textContent = value.toLocaleString();
                        
                        if (progress < 1) {
                            requestAnimationFrame(updateCount);
                        }
                    };
                    
                    requestAnimationFrame(updateCount);
                });
            }
            
            // Netlify Identity and CMS Integration
            if (window.netlifyIdentity) {
                window.netlifyIdentity.on("init", user => {
                    if (!user) {
                        window.netlifyIdentity.on("login", () => {
                            document.location.href = "/admin/";
                        });
                    }
                });
                
                // Check if user is logged in
                const currentUser = netlifyIdentity.currentUser();
                if (currentUser) {
                    document.getElementById('cmsAdminBtn').style.display = 'flex';
                }
                
                // Listen for login events
                netlifyIdentity.on('login', user => {
                    document.getElementById('cmsAdminBtn').style.display = 'flex';
                    closeModal();
                });
                
                // Listen for logout events
                netlifyIdentity.on('logout', () => {
                    document.getElementById('cmsAdminBtn').style.display = 'none';
                });
            }
            
            // Modal functions
            function openModal() {
                document.getElementById('cmsModal').style.display = 'flex';
            }
            
            function closeModal() {
                document.getElementById('cmsModal').style.display = 'none';
            }
            
            // Admin link click handler
            document.querySelector('.admin-link').addEventListener('click', function(e) {
                e.preventDefault();
                openModal();
            });
            
            // Close modal when clicking outside
            document.getElementById('cmsModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>
